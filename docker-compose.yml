version: '2.1'

services:
  payments-api:
    build:
      context: .
      args:
        - http_proxy
        - https_proxy
        - no_proxy
    image: hmcts.azurecr.io/hmcts/fees-register-api/payments-api
    environment:
      - SPRING_DATASOURCE_URL=jdbc:postgresql://payments-database:5432/payment
      - SPRING_DATASOURCE_USERNAME=fees_register
      - SPRING_DATASOURCE_PASSWORD=fees_register
      - auth.provider.service.client.baseUrl=http://service-auth-provider-api:8080/
      - auth.idam.client.baseUrl=https://idam-test.dev.ccidam.reform.hmcts.net
      - payments.report.file.location=.
    ports:
     - 8080:8080
    links:
     - payments-database
     - service-auth-provider-api
     - fees-api
    depends_on:
     - payments-database
     - service-auth-provider-api
     - fees-api

  payments-database:
    build:
      context: docker/database
    image: postgres:11-alpine
    environment:
      - POSTGRES_USER=payment
      - POSTGRES_PASSWORD=payment
      - POSTGRES_DB=payment
    ports:
      - 5430:5432

  # service-auth-provider
  service-auth-provider-api:
    image: docker.artifactory.reform.hmcts.net/auth/service-auth-provider-api
    environment:
      - auth.provider.service.server.jwtKey=wThK0f0/lh3FlxFcL4xUWDMI5C1J9KyQBgXV4wseh1e5J1uYJIjvTvArHxQDrYoHJ23xFxjHkOnvNbR5dXRoxA==
      - auth.provider.service.server.microserviceKeys.divorce=AAAAAAAAAAAAAAAA
      - auth.provider.service.testing-support.enabled=true
    ports:
      - 8085:8080

  fees-api:
    build:
      context: .
      args:
      - http_proxy
      - https_proxy
      - no_proxy
    image: hmcts.azurecr.io/hmcts/fees-register-api
    container_name: fees-api
    environment:
    - SPRING_DATASOURCE_URL=jdbc:postgresql://fees-database:5432/fees_register
    - SPRING_DATASOURCE_USERNAME=fees_register
    - SPRING_DATASOURCE_PASSWORD=fees_register
    - AUTH_IDAM_CLIENT_BASEURL=https://idam-test.dev.ccidam.reform.hmcts.net
    ports:
    - 8182:8080
    depends_on:
    - fees-database

  fees-database:
    build:
      context: docker/database
    container_name: fees-database
    image: postgres:11-alpine
    environment:
    - POSTGRES_USER=fees_register
    - POSTGRES_PASSWORD=fees_register
    - POSTGRES_DB=fees_register
    ports:
    - 5182:5432
