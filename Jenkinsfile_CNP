#!groovy

properties(
    [[$class: 'GithubProjectProperty', projectUrlStr: 'https://github.com/hmcts/ccpay-payment-app.git'],
     pipelineTriggers([[$class: 'GitHubPushTrigger']])]
)

@Library('Infrastructure')

def type = "java"

def product = "payment"

def app = "api"

String notificationsChannel = '#cc-payments-tech'

withPipeline(type, product, app) {
afterCheckout {
    onMaster {
      try {
        sh """
          git fetch origin demo:demo
          git push --force origin HEAD:demo
        """
      } catch (err) {
        notifyBuildEvent channel: notificationsChannel, color: 'warning', message: 'Failed to update demo branch'
      }
    }
  }
    enableSlackNotifications(notificationsChannel)
}
